"use strict";(self["webpackChunkvue_shop"]=self["webpackChunkvue_shop"]||[]).push([[532],{1438:function(e,t,r){r.r(t),r.d(t,{default:function(){return c}});var s=function(){var e=this,t=e._self._c;return t("div",[t("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[t("el-breadcrumb-item",{attrs:{to:{path:"/home"}}},[e._v("首页")]),t("el-breadcrumb-item",[e._v("活动管理")]),t("el-breadcrumb-item",[e._v("活动列表")])],1),t("el-card",[t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:7}},[t("el-input",{attrs:{placeholder:"请输入内容",clearable:""},on:{clear:e.getUserListd},model:{value:e.queryInfo.query,callback:function(t){e.$set(e.queryInfo,"query","string"===typeof t?t.trim():t)},expression:"queryInfo.query"}},[t("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:e.getUserListd},slot:"append"})],1)],1),t("el-col",{attrs:{span:4}},[t("el-button",{attrs:{type:"primary"},on:{click:e.handleAdd}},[e._v("添加用户")])],1)],1),t("el-table",{attrs:{data:e.userList,border:"",stripe:""}},[t("el-table-column",{attrs:{label:"#",type:"index"}}),t("el-table-column",{attrs:{label:"姓名",prop:"username"}}),t("el-table-column",{attrs:{label:"邮箱",prop:"email"}}),t("el-table-column",{attrs:{label:"电话",prop:"mobile"}}),t("el-table-column",{attrs:{label:"角色",prop:"role_name"}}),t("el-table-column",{attrs:{label:"状态"},scopedSlots:e._u([{key:"default",fn:function(r){return[t("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#ff4949"},on:{change:function(t){return e.userStateChanged(r.row)}},model:{value:r.row.mg_state,callback:function(t){e.$set(r.row,"mg_state",t)},expression:"scope.row.mg_state"}})]}}])}),t("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(r){return[t("el-button",{attrs:{type:"primary",icon:"el-icon-edit"},on:{click:function(t){return e.handleEdit(r.row)}}}),t("el-button",{attrs:{type:"danger",icon:"el-icon-delete"},on:{click:function(t){return e.removeUser(r.row.id)}}}),t("el-tooltip",{attrs:{effect:"dark",content:"分配权限",placement:"top",enterable:!1}},[t("el-button",{attrs:{type:"warning",icon:"el-icon-setting"},on:{click:function(t){return e.setRole(r.row)}}})],1)]}}])})],1),t("el-pagination",{attrs:{"current-page":e.queryInfo.pagenum,"page-sizes":[1,2,5,10],"page-size":e.queryInfo.pagesize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1),t("el-dialog",{attrs:{title:0===e.modalType?"添加用户":"编辑用户",visible:e.isVisible,width:"50%"},on:{"update:visible":function(t){e.isVisible=t},close:e.DialogClose}},[t("el-form",{ref:"addForm",attrs:{model:e.addForm,rules:e.rules,"label-width":"70px","status-icon":"",inline:""}},[t("el-form-item",{attrs:{label:"用户名",prop:"username"}},[t("el-input",{attrs:{disabled:0!==e.modalType},model:{value:e.addForm.username,callback:function(t){e.$set(e.addForm,"username",t)},expression:"addForm.username"}})],1),t("el-form-item",{directives:[{name:"show",rawName:"v-show",value:1!==e.modalType,expression:"modalType !== 1"}],attrs:{label:"密码",prop:"password"}},[t("el-input",{model:{value:e.addForm.password,callback:function(t){e.$set(e.addForm,"password",t)},expression:"addForm.password"}})],1),t("el-form-item",{attrs:{label:"手机",prop:"mobile"}},[t("el-input",{model:{value:e.addForm.mobile,callback:function(t){e.$set(e.addForm,"mobile",t)},expression:"addForm.mobile"}})],1),t("el-form-item",{attrs:{label:"邮箱",prop:"email"}},[t("el-input",{model:{value:e.addForm.email,callback:function(t){e.$set(e.addForm,"email",t)},expression:"addForm.email"}})],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:e.DialogClose}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.submit}},[e._v("确 定")])],1)],1),t("el-dialog",{attrs:{title:"分配角色",visible:e.Rolevisible,width:"50%"},on:{"update:visible":function(t){e.Rolevisible=t}}},[t("div",[t("p",[e._v("当前用户："+e._s(e.userinfo.username))]),t("p",[e._v("当前角色："+e._s(e.userinfo.role_name))]),t("p",[e._v(" 分配新角色："),t("el-select",{attrs:{placeholder:"请选择"},model:{value:e.selectRoleId,callback:function(t){e.selectRoleId=t},expression:"selectRoleId"}},e._l(e.roleList,(function(e){return t("el-option",{key:e.id,attrs:{label:e.roleName,value:e.id}})})),1)],1)]),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.Rolevisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.saveRoleInfo}},[e._v("确 定")])],1)])],1)},a=[],i=r(586),o={name:"Users",data(){return{queryInfo:{query:"",pagenum:1,pagesize:2},userList:[],total:0,isVisible:!1,addForm:{id:"",username:"",password:"",email:"",mobile:""},modalType:0,rules:{username:[{required:!0,message:"请输入用户名称",trigger:"blur"},{min:3,max:10,message:"长度在3-10个字符",trigger:"blur"}],password:[{required:!0,message:"请输入用户密码",trigger:"blur"},{min:6,max:15,message:"长度在6-15个字符",trigger:"blur"}],email:[{type:"email",required:!0,message:"请输入邮箱",trigger:"blur"}],mobile:[{required:!0,message:"请输入手机号",trigger:"blur"}]},Rolevisible:!1,userinfo:{},roleList:[],selectRoleId:""}},methods:{getUserListd(){(0,i.lE)({params:this.queryInfo}).then((({data:e})=>{if(200!==e.meta.status)return this.$message.error(e.meta.msg);this.userList=e.data.users,this.total=e.data.total}))},handleSizeChange(e){this.queryInfo.pagesize=e,this.getUserListd()},handleCurrentChange(e){this.queryInfo.pagenum=e,this.getUserListd()},userStateChanged(e){(0,i.eV)(e).then((({data:t})=>{if(200!==t.meta.status)return e.mg_state=!e.mg_state,this.$message.error("更新状态失败");this.$message.success("更新状态成功")}))},DialogClose(){this.isVisible=!1,this.$refs.addForm.resetFields(),this.addForm={}},submit(){this.$refs.addForm.validate((e=>{e&&0===this.modalType&&(0,i.cn)(this.addForm).then((({data:e})=>{if(201!==e.meta.status)return this.$message.error("添加用户失败");this.$message.success("添加用户成功"),this.getUserListd()})),1===this.modalType&&(0,i.Xk)(this.addForm).then((({data:e})=>{if(console.log(e),200!==e.meta.status)return this.$message.error("更新用户失败");this.$message.success("更新用户成功"),this.getUserListd()})),this.DialogClose()}))},handleAdd(){this.modalType=0,this.isVisible=!0},handleEdit(e){this.modalType=1,this.isVisible=!0,this.addForm=JSON.parse(JSON.stringify(e))},removeUser(e){this.$confirm("此操作将永久删除该用户, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{(0,i.h8)(e).then((()=>{this.getUserListd()})),this.$message({type:"success",message:"删除成功!"})})).catch((()=>{this.$message({type:"info",message:"已取消删除"})}))},setRole(e){this.userinfo=e,(0,i.Sd)().then((({data:e})=>{if(200!==e.meta.status)return this.$message.error("获取角色列表失败！");this.roleList=e.data})),this.Rolevisible=!0},saveRoleInfo(){if(!this.selectRoleId)return this.$message.error("请选择要分配的角色");(0,i.tU)(this.userinfo,{rid:this.selectRoleId}).then((({data:e})=>{if(200!==e.meta.status)return this.$message.error("更新角色失败！");this.$message.success("更新角色成功！"),this.getUserListd(),this.Rolevisible=!1}))}},mounted(){this.getUserListd()}},l=o,n=r(1001),u=(0,n.Z)(l,s,a,!1,null,"6b2de974",null),c=u.exports},5386:function(e,t,r){r.r(t),r.d(t,{default:function(){return c}});var s=function(){var e=this,t=e._self._c;return t("div",[t("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[t("el-breadcrumb-item",{attrs:{to:{path:"/home"}}},[e._v("首页")]),t("el-breadcrumb-item",[e._v("权限管理")]),t("el-breadcrumb-item",[e._v("权限列表")])],1),t("el-card",[t("el-table",{attrs:{data:e.rights,border:"",stripe:""}},[t("el-table-column",{attrs:{label:"#",type:"index"}}),t("el-table-column",{attrs:{label:"权限名称",prop:"authName"}}),t("el-table-column",{attrs:{label:"路径",prop:"path"}}),t("el-table-column",{attrs:{label:"权限等级",prop:"level"},scopedSlots:e._u([{key:"default",fn:function(r){return["0"===r.row.level?t("el-tag",[e._v("一级")]):e._e(),"1"===r.row.level?t("el-tag",{attrs:{type:"success"}},[e._v("二级")]):e._e(),"2"===r.row.level?t("el-tag",{attrs:{type:"warning"}},[e._v("三级")]):e._e()]}}])})],1)],1)],1)},a=[],i=r(586),o={name:"Rights",data(){return{rights:[]}},methods:{rightsList(){(0,i.WC)().then((({data:e})=>{this.rights=e.data}))}},mounted(){this.rightsList()}},l=o,n=r(1001),u=(0,n.Z)(l,s,a,!1,null,null,null),c=u.exports},9211:function(e,t,r){r.r(t),r.d(t,{default:function(){return c}});var s=function(){var e=this,t=e._self._c;return t("div",[t("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[t("el-breadcrumb-item",{attrs:{to:{path:"/home"}}},[e._v("首页")]),t("el-breadcrumb-item",[e._v("权限管理")]),t("el-breadcrumb-item",[e._v("角色列表")])],1),t("el-card",[t("el-row",[t("el-col",[t("el-button",{attrs:{type:"primary"}},[e._v("添加角色")])],1)],1),t("el-table",{attrs:{data:e.roleList,border:"",stripe:""}},[t("el-table-column",{attrs:{type:"expand"},scopedSlots:e._u([{key:"default",fn:function(r){return e._l(r.row.children,(function(s,a){return t("el-row",{key:s.id,class:["bdbottom",0===a?"bdtop":"","vcenter"]},[t("el-col",{attrs:{span:5}},[t("el-tag",{attrs:{closable:""},on:{close:function(t){return e.removeRight(r.row,s.id)}}},[e._v(" "+e._s(s.authName)+" ")]),t("i",{staticClass:"el-icon-caret-right"})],1),t("el-col",{attrs:{span:19}},e._l(s.children,(function(s,a){return t("el-row",{key:s.id,class:[0===a?"":"bdtop","vcenter"]},[t("el-col",{attrs:{span:6}},[t("el-tag",{attrs:{type:"success",closable:""},on:{close:function(t){return e.removeRight(r.row,s.id)}}},[e._v(e._s(s.authName))]),t("i",{staticClass:"el-icon-caret-right"})],1),t("el-col",{attrs:{span:18}},e._l(s.children,(function(s,a){return t("el-tag",{key:s.id,attrs:{type:"warning",closable:""},on:{close:function(t){return e.removeRight(r.row,s.id)}}},[e._v(e._s(s.authName))])})),1)],1)})),1)],1)}))}}])}),t("el-table-column",{attrs:{type:"index"}}),t("el-table-column",{attrs:{label:"角色名称",prop:"roleName"}}),t("el-table-column",{attrs:{label:"角色描述",prop:"roleDesc"}}),t("el-table-column",{attrs:{label:"操作",width:"300px"},scopedSlots:e._u([{key:"default",fn:function(r){return[t("el-button",{attrs:{size:"mini",type:"primary",icon:"el-icon-edit"}},[e._v("编辑")]),t("el-button",{attrs:{size:"mini",type:"danger",icon:"el-icon-delete"}},[e._v("删除")]),t("el-button",{attrs:{size:"mini",type:"warning",icon:"el-icon-setting"},on:{click:function(t){return e.showSetRight(r.row)}}},[e._v("分配权限")])]}}])})],1)],1),t("el-dialog",{attrs:{title:"分配权限",visible:e.isVisible,width:"50%"},on:{"update:visible":function(t){e.isVisible=t}}},[t("el-tree",{ref:"treeRef",attrs:{data:e.rightList,props:e.treeProps,"show-checkbox":"","node-key":"id","default-expand-all":"","default-checked-keys":e.defKeys}}),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.isVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.allotRights}},[e._v("确 定")])],1)],1)],1)},a=[],i=(r(7658),r(586)),o={name:"Roles",data(){return{roleList:[],isVisible:!1,rightList:[],treeProps:{label:"authName",children:"children"},defKeys:[],roleId:""}},methods:{getRoleList(){(0,i.Sd)().then((({data:e})=>{if(200!==e.meta.status)return this.$message.error("获取角色列表失败！");this.roleList=e.data}))},removeRight(e,t){this.$confirm("此操作将永久删除该权限, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{this.$message({type:"success",message:"删除成功!"}),(0,i.ZR)(e,t).then((({data:t})=>{e.children=t.data}))})).catch((()=>{this.$message({type:"info",message:"已取消删除"})}))},showSetRight(e){this.roleId=e.id,(0,i.EK)().then((({data:e})=>{if(200!==e.meta.status)return this.$message.error("获取权限失败");this.rightList=e.data})),this.defKeys=[],this.getLeafKeys(e,this.defKeys),this.isVisible=!0},getLeafKeys(e,t){if(!e.children)return t.push(e.id);e.children.forEach((e=>{this.getLeafKeys(e,t)}))},allotRights(){const e=[...this.$refs.treeRef.getCheckedKeys(),...this.$refs.treeRef.getHalfCheckedKeys()],t=e.join(",");(0,i.fu)(this.roleId,{rids:t}).then((({data:e})=>{if(console.log(e),200!==e.meta.status)return this.$message.error("分配权限失败");this.$message.success("分配成功"),this.getRoleList()})),this.isVisible=!1}},mounted(){this.getRoleList()}},l=o,n=r(1001),u=(0,n.Z)(l,s,a,!1,null,"3d858096",null),c=u.exports},586:function(e,t,r){r.d(t,{tU:function(){return y},Xk:function(){return m},m3:function(){return l},kV:function(){return w},Rq:function(){return q},F1:function(){return L},cn:function(){return d},fu:function(){return v},JG:function(){return k},aH:function(){return S},sW:function(){return C},ZR:function(){return f},h8:function(){return h},fT:function(){return $},AZ:function(){return F},J:function(){return n},hN:function(){return _},GI:function(){return V},od:function(){return I},cu:function(){return U},Qf:function(){return x},F4:function(){return R},EK:function(){return b},WC:function(){return p},Sd:function(){return g},lE:function(){return u},eV:function(){return c}});var s=r(7467),a=r.n(s);const i=a().create({baseURL:"http://127.0.0.1:8888/api/private/v1/",timeout:5e3});i.interceptors.request.use((function(e){return e.headers.Authorization=window.sessionStorage.getItem("token"),e}),(function(e){return Promise.reject(e)})),i.interceptors.response.use((function(e){return e}),(function(e){return Promise.reject(e)}));var o=i;const l=e=>o.post("/login",e),n=()=>o.get("/menus"),u=e=>o.get("users/",e),c=e=>o.put(`users/${e.id}/state/${e.mg_state}`,e),d=e=>o.post("users/",e),m=e=>o.put(`users/${e.id}`,{email:e.email,mobile:e.mobile}),h=e=>o.delete(`users/${e}`,e),p=()=>o.get("rights/list"),g=()=>o.get("roles"),f=(e,t)=>o.delete(`roles/${e.id}/rights/${t}`,e,t),b=()=>o.get("rights/tree"),v=(e,t)=>o.post(`roles/${e}/rights`,t),y=(e,t)=>o.put(`users/${e.id}/role`,t),_=e=>o.get("categories/",e),w=e=>o.post("categories/",e),$=e=>o.put(`categories/${e.cat_id}`,e),k=e=>o.delete(`categories/${e}`,e),R=(e,t)=>o.get(`categories/${e}/attributes`,t),L=(e,t)=>o.post(`categories/${e}/attributes`,t),x=(e,t,r)=>o.get(`categories/${e}/attributes/${t}`,r),F=(e,t,r)=>o.put(`categories/${e}/attributes/${t}`,r),C=(e,t)=>o.delete(`categories/${e}/attributes/${t}`),I=e=>o.get("goods",e),q=e=>o.post("goods",e),S=e=>o.delete(`goods/${e}`),U=e=>o.get("orders",e),V=()=>o.get("reports/type/1")}}]);
//# sourceMappingURL=Uers_Rights_Roles.c2552179.js.map